<template>
  <ion-grid class="ion-padding-vertical h-full">
    <ion-row>
      <ion-col size="1">
        <time-filter></time-filter>
      </ion-col>
      <ion-col size="5">
        <img
          src="@/assets/img/time-funnel_v4.png"
          alt="Time funnel"
          id="time-funnel-img"
        />
      </ion-col>
      <ion-col size="6">
        <div class="theme-select-title">
          <h2>
            Explore the themes
          </h2>
          <p>By clicking on the color map</p>
        </div>

        <div class="theme-select-blobs-container">
          <img
            src="@/assets/img/blobs_v7.png"
            usemap="#image-map"
            id="blobs-img"
            alt="Theme select image"
          />

          <map name="image-map">
            <area
              target=""
              alt="equity"
              title="equity"
              href=""
              coords="182,465,253,416,314,389,376,374,444,371,513,384,565,404,616,436,646,476,662,514,662,557,651,592,626,627,594,656,552,686,498,732,460,778,428,827,409,877,400,921,395,964,395,1010,401,1058,411,1096,428,1136,451,1177,476,1217,500,1250,530,1287,576,1333,624,1371,673,1403,727,1427,777,1444,827,1457,882,1462,932,1457,980,1441,1021,1425,1061,1406,1093,1382,1125,1352,1147,1324,1176,1292,1206,1258,1236,1235,1268,1217,1241,1222,1207,1233,1169,1247,1136,1262,1109,1273,1074,1284,1029,1290,988,1285,950,1276,918,1258,889,1230,864,1196,847,1158,837,1109,843,1069,861,1021,885,983,915,956,958,921,1001,889,1045,861,1087,840,1131,818,1182,799,1222,780,1263,753,1304,722,1335,684,1359,643,1378,592,1389,544,1394,498,1390,452,1384,406,1368,358,1352,319,1327,274,1297,228,1266,196,1233,168,1196,142,1163,120,1128,102,1083,86,1026,74,975,66,921,61,862,61,805,67,753,75,707,85,656,99,606,115,552,137,497,164,441,198,390,233,342,271,303,307,263,350,222,403"
              shape="poly"
            />
            <area
              target=""
              alt="teachingPractice"
              title="teachingPractice"
              href=""
              coords="74,841,92,799,120,759,159,721,206,686,256,654,313,628,372,606,431,589,494,576,550,570,605,565,655,562,707,563,763,563,820,568,881,576,933,587,987,603,1043,620,1087,643,1132,673,1168,714,1191,749,1203,792,1200,834,1191,875,1171,911,1146,946,1105,972,1055,996,1005,1015,957,1024,914,1034,871,1047,825,1063,780,1080,742,1094,704,1118,677,1144,659,1179,650,1217,656,1253,671,1290,690,1317,721,1349,755,1374,798,1390,838,1396,882,1400,923,1398,976,1390,1019,1381,1063,1368,1097,1353,1124,1338,1111,1358,1097,1385,1071,1416,1047,1439,1019,1466,987,1493,958,1517,917,1544,871,1565,817,1584,745,1598,672,1602,610,1598,551,1587,485,1570,424,1547,370,1520,329,1490,286,1457,254,1423,213,1375,182,1325,157,1279,127,1218,105,1155,89,1107,76,1037,65,983,62,942,63,889"
              shape="poly"
            />
            <area
              target=""
              alt="academicAchievementAssessment"
              title="academicAchievementAssessment"
              href=""
              coords="137,1249,202,1327,264,1388,318,1426,391,1462,482,1504,555,1524,641,1540,736,1540,825,1521,903,1496,965,1461,1026,1421,1081,1376,1126,1338,1164,1295,1208,1256,1262,1219,1321,1198,1383,1183,1454,1168,1519,1160,1578,1149,1624,1131,1661,1100,1685,1065,1704,1023,1724,956,1736,899,1732,982,1723,1050,1707,1122,1689,1179,1659,1251,1640,1294,1613,1338,1583,1383,1556,1421,1523,1461,1481,1504,1435,1545,1383,1586,1325,1623,1270,1653,1204,1680,1141,1702,1076,1721,1007,1733,937,1737,866,1741,797,1733,729,1723,657,1706,594,1682,535,1658,476,1626,417,1590,363,1550,310,1505,266,1456,221,1396,185,1343"
              shape="poly"
            />
            <area
              target=""
              alt="affect"
              title="affect"
              href=""
              coords="90,682,100,649,109,616,125,581,138,546,155,512,182,464,225,423,268,390,311,364,356,347,403,331,456,320,508,315,570,315,629,317,682,320,731,326,782,333,846,340,903,350,963,367,1020,383,1075,401,1127,422,1176,444,1221,463,1264,487,1305,507,1348,534,1394,560,1440,588,1487,624,1522,658,1560,694,1595,734,1633,783,1663,828,1685,880,1700,936,1711,998,1710,1075,1704,1132,1687,1191,1669,1234,1652,1271,1629,1314,1607,1353,1577,1392,1552,1427,1521,1463,1488,1495,1456,1525,1424,1551,1388,1582,1343,1611,1299,1635,1253,1657,1198,1681,1135,1702,1070,1719,990,1735,1073,1708,1124,1679,1171,1648,1211,1609,1237,1570,1245,1517,1243,1466,1230,1420,1198,1375,1157,1342,1111,1320,1059,1306,1014,1298,957,1290,906,1282,844,1275,780,1271,729,1263,677,1253,607,1242,540,1226,465,1210,392,1191,326,1169,252,1140,181,1107,140,1065,108,1022,81,973,67,909,62,838,66,792,73,751,81,713"
              shape="poly"
            />
            <area
              target=""
              alt="contextTeaching"
              title="contextTeaching"
              href=""
              coords="707,87,752,86,795,89,839,102,878,114,914,135,954,161,984,192,1002,232,1005,267,1000,302,989,336,968,374,936,404,909,431,878,460,836,493,796,525,758,557,717,587,682,609,649,630,614,650,575,674,540,700,505,727,475,751,440,779,399,809,348,851,307,892,270,929,240,970,216,1016,194,1072,184,1127,187,1186,195,1236,208,1280,227,1323,254,1369,283,1410,315,1453,350,1487,388,1514,431,1542,482,1565,539,1587,602,1606,663,1616,728,1619,792,1619,852,1611,911,1603,968,1585,1022,1565,1073,1544,1122,1520,1170,1493,1218,1464,1261,1437,1312,1410,1361,1379,1409,1347,1461,1312,1504,1275,1549,1236,1595,1191,1633,1150,1669,1102,1700,1045,1717,989,1735,932,1743,878,1738,816,1730,758,1719,698,1704,642,1685,588,1663,539,1638,488,1609,445,1579,399,1541,350,1501,307,1463,272,1420,235,1375,205,1328,172,1269,143,1213,119,1157,100,1107,86,1060,76,1017,70,967,64,922,62,873,62,833,64,795,68,757,73"
              shape="poly"
            />
          </map>

          <p class="theme-select-annotation-text">
            <em
              >Cross-section showing intertwined conversation themes running
              through top 50 Clarivate journals during selected timestamp.</em
            >
          </p>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</template>

<script>
import $ from "jquery";
import "imagemapster";
import { mapGetters, mapMutations } from "vuex";
import { lineDrawingMixin } from "@/mixins/lineDrawingMixin";
import { imageMapMixin } from "@/mixins/imageMapMixin";
import TimeFilter from "@/components/TimeFilter";

export default {
  name: "ThemeSelect",
  mixins: [lineDrawingMixin, imageMapMixin],
  components: { TimeFilter },
  computed: {
    ...mapGetters({
      getThemeTitle: "themes/getThemeTitle",
      selectedThemeIds: "themes/getSelectedThemeIds",
    }),
  },
  data() {
    return {};
  },
  watch: {
    selectedThemeIds: {
      handler: function (newThemes, prevThemes) {
        $("area").each((index, area) => {
          const themeId = $(area).attr("name");
          const isSelected = newThemes.includes(themeId);
          $(area).mapster("set", isSelected);
        });
      },
      deep: true,
    },
  },
  methods: {
    ...mapMutations({
      toggleTheme: "themes/toggleTheme",
    }),
    initializeLineDrawing() {
      // setInterval(() => {
      //   this.$store.dispatch(
      //     "lineDrawing/drawLineBetweenThemeSelectAndTimeFunnel"
      //   );
      // }, 50);
    },
  },
  mounted() {
    this.initializeImageMap();
    this.initializeLineDrawing();
  },
};
</script>

<style>
#blobs-img {
  width: 100%;
}

#time-funnel-img {
  height: 100%;
  max-width: 100%;
}

.theme-select-annotation-text {
  text-align: center;
  font-size: 0.85em;
  width: 80%;
  margin: 10px auto 0;
}

.theme-select-blobs-container {
  position: absolute;
  top: 85px;
  right: 0;
  width: 100%;
}

.theme-select-title {
  text-align: center;
}

.theme-select-title h2 {
  margin-bottom: 0;
}

.theme-select-title p {
  margin-top: 8px;
}
</style>
